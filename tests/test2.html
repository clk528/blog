<p>1.使用 PHPExcel_IOFactory 读取文件</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li></ol></pre>
<p>2.使用一个特定的读取类，读取文件</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PHPExcel_Reader_Excel5</span><span class="pun">();</span><span class="pln">                   </span></code></li><li class="L1"><code class="lang-php"><span class="pln">    objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li></ol></pre>
<p>3.使用 PHPExcel_IOFactory 创建一个特定的读取类</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span><span class="pln">   </span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    </span><span class="com">//读取类型有：</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        $inputFileType </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Excel5'</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-php"><span class="pln">        $inputFileType </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Excel2007'</span><span class="pun">;</span></code></li><li class="L5"><code class="lang-php"><span class="pln">        $inputFileType </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Excel2003XML'</span><span class="pun">;</span></code></li><li class="L6"><code class="lang-php"><span class="pln">        $inputFileType </span><span class="pun">=</span><span class="pln"> </span><span class="str">'OOCalc'</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-php"><span class="pln">        $inputFileType </span><span class="pun">=</span><span class="pln"> </span><span class="str">'SYLK'</span><span class="pun">;</span></code></li><li class="L8"><code class="lang-php"><span class="pln">        $inputFileType </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Gnumeric'</span><span class="pun">;</span></code></li><li class="L9"><code class="lang-php"><span class="pln">        $inputFileType </span><span class="pun">=</span><span class="pln"> </span><span class="str">'CSV'</span><span class="pun">;</span></code></li></ol></pre>
<p>4.使用 PHPExcel_IOFactory 来鉴别文件应该使用哪一个读取类</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $inputFileType </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">identify</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li></ol></pre>
<p>5.只读去数据，忽略里面各种格式等(对于Excel读去，有很大优化)</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $objReader</span><span class="pun">-&gt;</span><span class="pln">setReadDataOnly</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li></ol></pre>
<p>6.加载Excel所有的工作表</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $objReader</span><span class="pun">-&gt;</span><span class="pln">setLoadAllSheets</span><span class="pun">();</span><span class="pln">        </span><span class="com">// 加载所有的工作表</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li><li class="L3"><code class="lang-php"><span class="pln">    $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getSheetCount</span><span class="pun">();</span><span class="pln">        </span><span class="com">// 获取工作表的个数</span></code></li><li class="L4"><code class="lang-php"><span class="pln">    $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getSheetNames</span><span class="pun">();</span><span class="pln">        </span><span class="com">// 获取所有工作表的名字数组</span></code></li></ol></pre>
<p>7.加载单个的命名的工作表</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $sheetname </span><span class="pun">=</span><span class="pln"> </span><span class="str">'Data Sheet #2'</span><span class="pun">;</span><span class="pln">        </span><span class="com">// 单个工作表，传入字符串</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    $objReader</span><span class="pun">-&gt;</span><span class="pln">setLoadSheetsOnly</span><span class="pun">(</span><span class="pln">$sheetname</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 加载单个工作表，传入工作表名字(例如：'Data Sheet #2')</span></code></li><li class="L3"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li></ol></pre>
<p>8.加载多个命名的工作表</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $sheetnames </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'Data Sheet #1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Data Sheet #2'</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 多个工作表，传入数组</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    $objReader</span><span class="pun">-&gt;</span><span class="pln">setLoadSheetsOnly</span><span class="pun">(</span><span class="pln">$sheetnames</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 加载多个工作表，传入工作表名字数组</span></code></li><li class="L3"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li></ol></pre>
<p>9.自定义一个读去过滤器</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyReadFilter</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">PHPExcel_Reader_IReadFilter</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-php"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> readCell</span><span class="pun">(</span><span class="pln">$column</span><span class="pun">,</span><span class="pln"> $row</span><span class="pun">,</span><span class="pln"> $worksheetName </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="lang-php"></code></li><li class="L4"><code class="lang-php"></code></li><li class="L5"><code class="lang-php"><span class="pln">            </span><span class="com">// 只读去1-7行&amp;A－E列中的单元格</span></code></li><li class="L6"><code class="lang-php"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$row </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> $row </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">7</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="lang-php"><span class="pln">                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">in_array</span><span class="pun">(</span><span class="pln">$column</span><span class="pun">,</span><span class="pln">range</span><span class="pun">(</span><span class="str">'A'</span><span class="pun">,</span><span class="str">'E'</span><span class="pun">)))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="lang-php"><span class="pln">                    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L9"><code class="lang-php"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L0"><code class="lang-php"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L1"><code class="lang-php"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L2"><code class="lang-php"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L3"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code class="lang-php"><span class="pln">    $filterSubset </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyReadFilter</span><span class="pun">();</span></code></li><li class="L5"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-php"><span class="pln">    $objReader</span><span class="pun">-&gt;</span><span class="pln">setReadFilter</span><span class="pun">(</span><span class="pln">$filterSubset</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 设置实例化的过滤器对象</span></code></li><li class="L7"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li></ol></pre>
<p>10.同样是自定义一个读去过滤器，但可配置读去的行和列范围</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyReadFilter</span><span class="pln"> </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">PHPExcel_Reader_IReadFilter</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-php"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> $_startRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">        </span><span class="com">// 开始行</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> $_endRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">        </span><span class="com">// 结束行</span></code></li><li class="L4"><code class="lang-php"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> $_columns </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">();</span><span class="pln">    </span><span class="com">// 列跨度</span></code></li><li class="L5"><code class="lang-php"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> __construct</span><span class="pun">(</span><span class="pln">$startRow</span><span class="pun">,</span><span class="pln"> $endRow</span><span class="pun">,</span><span class="pln"> $columns</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="lang-php"><span class="pln">            $this</span><span class="pun">-&gt;</span><span class="pln">_startRow    </span><span class="pun">=</span><span class="pln"> $startRow</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-php"><span class="pln">            $this</span><span class="pun">-&gt;</span><span class="pln">_endRow        </span><span class="pun">=</span><span class="pln"> $endRow</span><span class="pun">;</span></code></li><li class="L8"><code class="lang-php"><span class="pln">            $this</span><span class="pun">-&gt;</span><span class="pln">_columns        </span><span class="pun">=</span><span class="pln"> $columns</span><span class="pun">;</span></code></li><li class="L9"><code class="lang-php"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L0"><code class="lang-php"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> readCell</span><span class="pun">(</span><span class="pln">$column</span><span class="pun">,</span><span class="pln"> $row</span><span class="pun">,</span><span class="pln"> $worksheetName </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-php"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$row </span><span class="pun">&gt;=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_startRow </span><span class="pun">&amp;&amp;</span><span class="pln"> $row </span><span class="pun">&lt;=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_endRow</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-php"><span class="pln">                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">in_array</span><span class="pun">(</span><span class="pln">$column</span><span class="pun">,</span><span class="pln">$this</span><span class="pun">-&gt;</span><span class="pln">_columns</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="lang-php"><span class="pln">                    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-php"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L5"><code class="lang-php"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L6"><code class="lang-php"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-php"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code class="lang-php"><span class="pln">    $filterSubset </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MyReadFilter</span><span class="pun">(</span><span class="lit">9</span><span class="pun">,</span><span class="lit">15</span><span class="pun">,</span><span class="pln">range</span><span class="pun">(</span><span class="str">'G'</span><span class="pun">,</span><span class="str">'K'</span><span class="pun">));</span></code></li><li class="L0"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $objReader</span><span class="pun">-&gt;</span><span class="pln">setReadFilter</span><span class="pun">(</span><span class="pln">$filterSubset</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 设置实例化的过滤器对象</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li></ol></pre>
<p>11.分块读取Excel，原理还是：自定义读取过滤器</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> chunkReadFilter </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">PHPExcel_Reader_IReadFilter</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-php"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> $_startRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">        </span><span class="com">// 开始行</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> $_endRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">        </span><span class="com">// 结束行</span></code></li><li class="L4"><code class="lang-php"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> __construct</span><span class="pun">(</span><span class="pln">$startRow</span><span class="pun">,</span><span class="pln"> $chunkSize</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">    </span><span class="com">// 我们需要传递：开始行号&amp;行跨度(来计算结束行号)</span></code></li><li class="L5"><code class="lang-php"><span class="pln">            $this</span><span class="pun">-&gt;</span><span class="pln">_startRow    </span><span class="pun">=</span><span class="pln"> $startRow</span><span class="pun">;</span></code></li><li class="L6"><code class="lang-php"><span class="pln">            $this</span><span class="pun">-&gt;</span><span class="pln">_endRow        </span><span class="pun">=</span><span class="pln"> $startRow </span><span class="pun">+</span><span class="pln"> $chunkSize</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-php"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-php"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> readCell</span><span class="pun">(</span><span class="pln">$column</span><span class="pun">,</span><span class="pln"> $row</span><span class="pun">,</span><span class="pln"> $worksheetName </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="lang-php"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">$row </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$row </span><span class="pun">&gt;=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_startRow </span><span class="pun">&amp;&amp;</span><span class="pln"> $row </span><span class="pun">&lt;</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_endRow</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="lang-php"><span class="pln">                </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L1"><code class="lang-php"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L2"><code class="lang-php"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-php"><span class="pln">    $chunkSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">20</span><span class="pun">;</span><span class="pln">    </span><span class="com">// 定义每块读去的行数</span></code></li><li class="L7"><code class="lang-php"></code></li><li class="L8"><code class="lang-php"></code></li><li class="L9"><code class="lang-php"><span class="pln">    </span><span class="com">// 就可在一个循环中，多次读去块，而不用一次性将整个Excel表读入到内存中</span></code></li><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$startRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> $startRow </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">240</span><span class="pun">;</span><span class="pln"> $startRow </span><span class="pun">+=</span><span class="pln"> $chunkSize</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-php"><span class="pln">        $chunkFilter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> chunkReadFilter</span><span class="pun">(</span><span class="pln">$startRow</span><span class="pun">,</span><span class="pln"> $chunkSize</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-php"><span class="pln">        $objReader</span><span class="pun">-&gt;</span><span class="pln">setReadFilter</span><span class="pun">(</span><span class="pln">$chunkFilter</span><span class="pun">);</span><span class="pln">    </span><span class="com">// 设置实例化的过滤器对象</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li><li class="L4"><code class="lang-php"><span class="pln">        </span><span class="com">// 开始读取每行数据，并插入到数据库</span></code></li><li class="L5"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
<p>12.分块读取Excel的第2个版本</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> chunkReadFilter </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">PHPExcel_Reader_IReadFilter</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-php"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> $_startRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">        </span><span class="com">// 开始行</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> $_endRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">        </span><span class="com">// 结束行</span></code></li><li class="L4"><code class="lang-php"></code></li><li class="L5"><code class="lang-php"></code></li><li class="L6"><code class="lang-php"><span class="pln">        </span><span class="com">// 定义了一个读去指定范围行的方法</span></code></li><li class="L7"><code class="lang-php"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setRows</span><span class="pun">(</span><span class="pln">$startRow</span><span class="pun">,</span><span class="pln"> $chunkSize</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="lang-php"><span class="pln">            $this</span><span class="pun">-&gt;</span><span class="pln">_startRow    </span><span class="pun">=</span><span class="pln"> $startRow</span><span class="pun">;</span></code></li><li class="L9"><code class="lang-php"><span class="pln">            $this</span><span class="pun">-&gt;</span><span class="pln">_endRow        </span><span class="pun">=</span><span class="pln"> $startRow </span><span class="pun">+</span><span class="pln"> $chunkSize</span><span class="pun">;</span></code></li><li class="L0"><code class="lang-php"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1"><code class="lang-php"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> readCell</span><span class="pun">(</span><span class="pln">$column</span><span class="pun">,</span><span class="pln"> $row</span><span class="pun">,</span><span class="pln"> $worksheetName </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-php"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">$row </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$row </span><span class="pun">&gt;=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_startRow </span><span class="pun">&amp;&amp;</span><span class="pln"> $row </span><span class="pun">&lt;</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_endRow</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="lang-php"><span class="pln">                </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-php"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L5"><code class="lang-php"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L6"><code class="lang-php"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L7"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L9"><code class="lang-php"><span class="pln">    $chunkSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">20</span><span class="pun">;</span><span class="pln">    </span><span class="com">// 定义每块读去的行数</span></code></li><li class="L0"><code class="lang-php"></code></li><li class="L1"><code class="lang-php"></code></li><li class="L2"><code class="lang-php"><span class="pln">    </span><span class="com">// 在循环外部，实例化过滤器类，而不用循环内每次实例化(应该更优化)</span></code></li><li class="L3"><code class="lang-php"><span class="pln">    $chunkFilter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> chunkReadFilter</span><span class="pun">();</span></code></li><li class="L4"><code class="lang-php"><span class="pln">    $objReader</span><span class="pun">-&gt;</span><span class="pln">setReadFilter</span><span class="pun">(</span><span class="pln">$chunkFilter</span><span class="pun">);</span></code></li><li class="L5"><code class="lang-php"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$startRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> $startRow </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">240</span><span class="pun">;</span><span class="pln"> $startRow </span><span class="pun">+=</span><span class="pln"> $chunkSize</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="lang-php"></code></li><li class="L7"><code class="lang-php"></code></li><li class="L8"><code class="lang-php"><span class="pln">        </span><span class="com">// 循环内部，使用实例化的对象的方法，来调整读取的行范围即可</span></code></li><li class="L9"><code class="lang-php"><span class="pln">        $chunkFilter</span><span class="pun">-&gt;</span><span class="pln">setRows</span><span class="pun">(</span><span class="pln">$startRow</span><span class="pun">,</span><span class="pln">$chunkSize</span><span class="pun">);</span></code></li><li class="L0"><code class="lang-php"><span class="pln">        $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
<p>13.读取多个CSV文件</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $inputFileNames </span><span class="pun">=</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'./sampleData/example1.csv'</span><span class="pun">,</span><span class="str">'./sampleData/example2.csv'</span><span class="pun">);</span><span class="pln">    </span><span class="com">// CSV文件数组</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-php"></code></li><li class="L3"><code class="lang-php"></code></li><li class="L4"><code class="lang-php"><span class="pln">    </span><span class="com">/*</span></code></li><li class="L5"><code class="lang-php"><span class="com">        说明下面是干啥的：</span></code></li><li class="L6"><code class="lang-php"><span class="com">            1.先载入第一个CSV作为第一个工作表 | 设置工作表的标题</span></code></li><li class="L7"><code class="lang-php"><span class="com">            2.依次将多个CSV再入到 objPHPExcel 对象中，依次追加到第N个工作表 | 设置工作表的标题</span></code></li><li class="L8"><code class="lang-php"><span class="com">            3.获取Excel此时所有的标题，通过标题来依次获取工作表，然后对工作表进行操作！</span></code></li><li class="L9"><code class="lang-php"><span class="com">     */</span></code></li><li class="L0"><code class="lang-php"><span class="pln">    $inputFileName </span><span class="pun">=</span><span class="pln"> array_shift</span><span class="pun">(</span><span class="pln">$inputFileNames</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 第一个CSV文件</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span><span class="pln">    </span><span class="com">// 读取第一个CSV文件</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getActiveSheet</span><span class="pun">()-&gt;</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln">pathinfo</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">,</span><span class="pln">PATHINFO_BASENAME</span><span class="pun">));</span><span class="pln">    </span><span class="com">// 设置标题</span></code></li><li class="L3"><code class="lang-php"><span class="pln">    </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$inputFileNames </span><span class="kwd">as</span><span class="pln"> $sheet </span><span class="pun">=&gt;</span><span class="pln"> $inputFileName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="lang-php"><span class="pln">        $objReader</span><span class="pun">-&gt;</span><span class="pln">setSheetIndex</span><span class="pun">(</span><span class="pln">$sheet</span><span class="pun">+</span><span class="lit">1</span><span class="pun">);</span><span class="pln">    </span><span class="com">// 将工作表切换到下个工作表</span></code></li><li class="L5"><code class="lang-php"><span class="pln">        $objReader</span><span class="pun">-&gt;</span><span class="pln">loadIntoExisting</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">,</span><span class="pln">$objPHPExcel</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 将下一个CSV文件，载入到已存在的PHPExcel对象中</span></code></li><li class="L6"><code class="lang-php"><span class="pln">        $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getActiveSheet</span><span class="pun">()-&gt;</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln">pathinfo</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">,</span><span class="pln">PATHINFO_BASENAME</span><span class="pun">));</span><span class="pln">        </span><span class="com">// 设置当前工作表的标题</span></code></li><li class="L7"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-php"></code></li><li class="L9"><code class="lang-php"></code></li><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="com">// 循环所有的工作表名称</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $loadedSheetNames </span><span class="pun">=</span><span class="pln"> $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getSheetNames</span><span class="pun">();</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$loadedSheetNames </span><span class="kwd">as</span><span class="pln"> $sheetIndex </span><span class="pun">=&gt;</span><span class="pln"> $loadedSheetName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">setActiveSheetIndexByName</span><span class="pun">(</span><span class="pln">$loadedSheetName</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 通过 '工作表名称' 来设置当前工作表为激活状态</span></code></li><li class="L4"><code class="lang-php"><span class="pln">        </span><span class="com">// 接着对当前激活的工作表，进行读取、数据库写入</span></code></li><li class="L5"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
<p>14.将一个大的CSV文件，按 ‘块’ 分成多个工作表(结合了12&amp;13的示例)</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="kwd">class</span><span class="pln"> chunkReadFilter </span><span class="kwd">implements</span><span class="pln"> </span><span class="typ">PHPExcel_Reader_IReadFilter</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-php"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> $_startRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">        </span><span class="com">// 开始行</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        </span><span class="kwd">private</span><span class="pln"> $_endRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">        </span><span class="com">// 结束行</span></code></li><li class="L4"><code class="lang-php"></code></li><li class="L5"><code class="lang-php"></code></li><li class="L6"><code class="lang-php"><span class="pln">        </span><span class="com">// 定义了一个读去指定范围行的方法</span></code></li><li class="L7"><code class="lang-php"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> setRows</span><span class="pun">(</span><span class="pln">$startRow</span><span class="pun">,</span><span class="pln"> $chunkSize</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="lang-php"><span class="pln">            $this</span><span class="pun">-&gt;</span><span class="pln">_startRow    </span><span class="pun">=</span><span class="pln"> $startRow</span><span class="pun">;</span></code></li><li class="L9"><code class="lang-php"><span class="pln">            $this</span><span class="pun">-&gt;</span><span class="pln">_endRow        </span><span class="pun">=</span><span class="pln"> $startRow </span><span class="pun">+</span><span class="pln"> $chunkSize</span><span class="pun">;</span></code></li><li class="L0"><code class="lang-php"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L1"><code class="lang-php"><span class="pln">        </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> readCell</span><span class="pun">(</span><span class="pln">$column</span><span class="pun">,</span><span class="pln"> $row</span><span class="pun">,</span><span class="pln"> $worksheetName </span><span class="pun">=</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="lang-php"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">((</span><span class="pln">$row </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$row </span><span class="pun">&gt;=</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_startRow </span><span class="pun">&amp;&amp;</span><span class="pln"> $row </span><span class="pun">&lt;</span><span class="pln"> $this</span><span class="pun">-&gt;</span><span class="pln">_endRow</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="lang-php"><span class="pln">                </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-php"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L5"><code class="lang-php"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">;</span></code></li><li class="L6"><code class="lang-php"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L7"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L9"><code class="lang-php"><span class="pln">    $chunkSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span><span class="pln">    </span><span class="com">// 定义每块读去的行数</span></code></li><li class="L0"><code class="lang-php"></code></li><li class="L1"><code class="lang-php"></code></li><li class="L2"><code class="lang-php"><span class="pln">    </span><span class="com">// 在循环外部，实例化过滤器类，而不用循环内每次实例化(应该更优化)</span></code></li><li class="L3"><code class="lang-php"><span class="pln">    $chunkFilter </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> chunkReadFilter</span><span class="pun">();</span></code></li><li class="L4"><code class="lang-php"><span class="pln">    $objReader</span><span class="pun">-&gt;</span><span class="pln">setReadFilter</span><span class="pun">(</span><span class="pln">$chunkFilter</span><span class="pun">)</span></code></li><li class="L5"><code class="lang-php"><span class="pln">              </span><span class="pun">-&gt;</span><span class="pln">setContiguous</span><span class="pun">(</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 这里出现了一个没见过的方法(先放着，忘记是干啥的了)</span></code></li><li class="L6"><code class="lang-php"></code></li><li class="L7"><code class="lang-php"></code></li><li class="L8"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PHPExcel</span><span class="pun">();</span></code></li><li class="L9"><code class="lang-php"><span class="pln">    $sheet </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">        </span><span class="com">// 第一个工作表下标</span></code></li><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$startRow </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span><span class="pln"> $startRow </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">240</span><span class="pun">;</span><span class="pln"> $startRow </span><span class="pun">+=</span><span class="pln"> $chunkSize</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-php"><span class="pln">        $chunkFilter</span><span class="pun">-&gt;</span><span class="pln">setRows</span><span class="pun">(</span><span class="pln">$startRow</span><span class="pun">,</span><span class="pln">$chunkSize</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-php"><span class="pln">        $objReader</span><span class="pun">-&gt;</span><span class="pln">setSheetIndex</span><span class="pun">(</span><span class="pln">$sheet</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 切换工作表</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        $objReader</span><span class="pun">-&gt;</span><span class="pln">loadIntoExisting</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">,</span><span class="pln">$objPHPExcel</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 将读取到的CSV块，载入到工作表</span></code></li><li class="L4"><code class="lang-php"><span class="pln">        $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getActiveSheet</span><span class="pun">()-&gt;</span><span class="pln">setTitle</span><span class="pun">(</span><span class="str">'Country Data #'</span><span class="pun">.(++</span><span class="pln">$sheet</span><span class="pun">));</span><span class="pln">        </span><span class="com">// 设置工作表标题</span></code></li><li class="L5"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L6"><code class="lang-php"></code></li><li class="L7"><code class="lang-php"></code></li><li class="L8"><code class="lang-php"><span class="pln">    </span><span class="com">// 循环所有的工作表名称</span></code></li><li class="L9"><code class="lang-php"><span class="pln">    $loadedSheetNames </span><span class="pun">=</span><span class="pln"> $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getSheetNames</span><span class="pun">();</span></code></li><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$loadedSheetNames </span><span class="kwd">as</span><span class="pln"> $sheetIndex </span><span class="pun">=&gt;</span><span class="pln"> $loadedSheetName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-php"><span class="pln">        $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">setActiveSheetIndexByName</span><span class="pun">(</span><span class="pln">$loadedSheetName</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 通过 '工作表名称' 来设置当前工作表为激活状态</span></code></li><li class="L2"><code class="lang-php"><span class="pln">        </span><span class="com">// 接着对当前激活的工作表，进行读取、数据库写入</span></code></li><li class="L3"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
<p>15.使用 ‘Advanced Value Binder’ 读取通过 ‘tab’ 分隔值的文件</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="typ">PHPExcel_Cell</span><span class="pun">::</span><span class="pln">setValueBinder</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">PHPExcel_Cell_AdvancedValueBinder</span><span class="pun">()</span><span class="pln"> </span><span class="pun">);</span><span class="pln">        </span><span class="com">// 设置单元格</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    $objReader</span><span class="pun">-&gt;</span><span class="pln">setDelimiter</span><span class="pun">(</span><span class="str">"\t"</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 设置分隔符为 '\t'(tab分隔)</span></code></li><li class="L3"><code class="lang-php"><span class="pln">    $objPHPExcel </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li><li class="L4"><code class="lang-php"><span class="pln">    $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getActiveSheet</span><span class="pun">()-&gt;</span><span class="pln">setTitle</span><span class="pun">(</span><span class="pln">pathinfo</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">,</span><span class="pln">PATHINFO_BASENAME</span><span class="pun">));</span><span class="pln">    </span><span class="com">// 设置标题</span></code></li><li class="L5"><code class="lang-php"><span class="pln">    $loadedSheetNames </span><span class="pun">=</span><span class="pln"> $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getSheetNames</span><span class="pun">();</span><span class="pln">        </span><span class="com">// 获取所有工作表名称</span></code></li><li class="L6"><code class="lang-php"></code></li><li class="L7"><code class="lang-php"></code></li><li class="L8"><code class="lang-php"><span class="pln">    </span><span class="lit">1</span><span class="pun">)格式化输出</span></code></li><li class="L9"><code class="lang-php"><span class="pln">    </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$loadedSheetNames </span><span class="kwd">as</span><span class="pln"> $sheetIndex </span><span class="pun">=&gt;</span><span class="pln"> $loadedSheetName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="lang-php"><span class="pln">        $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">setActiveSheetIndexByName</span><span class="pun">(</span><span class="pln">$loadedSheetName</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-php"><span class="pln">        $sheetData </span><span class="pun">=</span><span class="pln"> $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getActiveSheet</span><span class="pun">()-&gt;</span><span class="pln">toArray</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">    </span><span class="com">// 注意4个参数的区别</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code class="lang-php"><span class="pln">    </span><span class="lit">2</span><span class="pun">)未格式化输出</span></code></li><li class="L4"><code class="lang-php"><span class="pln">    </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$loadedSheetNames </span><span class="kwd">as</span><span class="pln"> $sheetIndex </span><span class="pun">=&gt;</span><span class="pln"> $loadedSheetName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="lang-php"><span class="pln">        $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">setActiveSheetIndexByName</span><span class="pun">(</span><span class="pln">$loadedSheetName</span><span class="pun">);</span></code></li><li class="L6"><code class="lang-php"><span class="pln">        $sheetData </span><span class="pun">=</span><span class="pln"> $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getActiveSheet</span><span class="pun">()-&gt;</span><span class="pln">toArray</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">,</span><span class="kwd">false</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">    </span><span class="com">// 注意4个参数的区别</span></code></li><li class="L7"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="lang-php"><span class="pln">    </span><span class="lit">3</span><span class="pun">)单元格原生值</span></code></li><li class="L9"><code class="lang-php"><span class="pln">    </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$loadedSheetNames </span><span class="kwd">as</span><span class="pln"> $sheetIndex </span><span class="pun">=&gt;</span><span class="pln"> $loadedSheetName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="lang-php"><span class="pln">        $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">setActiveSheetIndexByName</span><span class="pun">(</span><span class="pln">$loadedSheetName</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-php"><span class="pln">        $sheetData </span><span class="pun">=</span><span class="pln"> $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getActiveSheet</span><span class="pun">()-&gt;</span><span class="pln">toArray</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="kwd">false</span><span class="pun">,</span><span class="kwd">false</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">);</span><span class="pln">    </span><span class="com">// 注意4个参数的区别</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
<p>16.使用 ‘try/catch’ 控制Excel加载时的异常</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="lang-php"><span class="pln">        $objPHPExcel </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">load</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pun">(</span><span class="typ">PHPExcel_Reader_Exception</span><span class="pln"> $e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        </span><span class="kwd">die</span><span class="pun">(</span><span class="str">'Error loading file "'</span><span class="pun">.</span><span class="pln">pathinfo</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">,</span><span class="pln">PATHINFO_BASENAME</span><span class="pun">).</span><span class="str">'": '</span><span class="pun">.</span><span class="pln">$e</span><span class="pun">-&gt;</span><span class="pln">getMessage</span><span class="pun">());</span></code></li><li class="L4"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
<p>17.获取Excel的工作表名称列表</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $worksheetNames </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">listWorksheetNames</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span><span class="pln">        </span><span class="com">// 列出工作表名称</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    </span><span class="kwd">foreach</span><span class="pun">(</span><span class="pln">$worksheetNames </span><span class="kwd">as</span><span class="pln"> $worksheetName</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        echo $worksheetName</span><span class="pun">,</span><span class="str">'&lt;br /&gt;'</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
<p>18.不加载整个文件，或者Excel的工作表名称列表</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $objReader </span><span class="pun">=</span><span class="pln"> </span><span class="typ">PHPExcel_IOFactory</span><span class="pun">::</span><span class="pln">createReader</span><span class="pun">(</span><span class="pln">$inputFileType</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    $worksheetData </span><span class="pun">=</span><span class="pln"> $objReader</span><span class="pun">-&gt;</span><span class="pln">listWorksheetInfo</span><span class="pun">(</span><span class="pln">$inputFileName</span><span class="pun">);</span><span class="pln">            </span><span class="com">// 列出工作表列表</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    </span><span class="kwd">foreach</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$worksheetData </span><span class="kwd">as</span><span class="pln"> $worksheet</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="lang-php"><span class="pln">        echo </span><span class="str">'&lt;li&gt;'</span><span class="pun">,</span><span class="pln"> $worksheet</span><span class="pun">[</span><span class="str">'worksheetName'</span><span class="pun">],</span><span class="pln"> </span><span class="str">'&lt;br /&gt;'</span><span class="pun">;</span></code></li><li class="L4"><code class="lang-php"><span class="pln">        echo </span><span class="str">'Rows: '</span><span class="pun">,</span><span class="pln"> $worksheet</span><span class="pun">[</span><span class="str">'totalRows'</span><span class="pun">],</span><span class="pln"> </span><span class="str">' Columns: '</span><span class="pun">,</span><span class="pln"> $worksheet</span><span class="pun">[</span><span class="str">'totalColumns'</span><span class="pun">],</span><span class="pln"> </span><span class="str">'&lt;br /&gt;'</span><span class="pun">;</span></code></li><li class="L5"><code class="lang-php"><span class="pln">        echo </span><span class="str">'Cell Range: A1:'</span><span class="pun">,</span><span class="pln"> $worksheet</span><span class="pun">[</span><span class="str">'lastColumnLetter'</span><span class="pun">],</span><span class="pln"> $worksheet</span><span class="pun">[</span><span class="str">'totalRows'</span><span class="pun">];</span></code></li><li class="L6"><code class="lang-php"><span class="pln">        echo </span><span class="str">'&lt;/li&gt;'</span><span class="pun">;</span></code></li><li class="L7"><code class="lang-php"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>
<p>19.全程，有一个方法：</p>
<pre class="prettyprint linenums prettyprinted" style=""><ol class="linenums"><li class="L0"><code class="lang-php"><span class="pln">    $sheetData </span><span class="pun">=</span><span class="pln"> $objPHPExcel</span><span class="pun">-&gt;</span><span class="pln">getActiveSheet</span><span class="pun">()-&gt;</span><span class="pln">toArray</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="kwd">false</span><span class="pun">,</span><span class="kwd">false</span><span class="pun">,</span><span class="kwd">true</span><span class="pun">);</span></code></li><li class="L1"><code class="lang-php"><span class="pln">    getActiveSheet</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">获取当前激活的工作表</span></code></li><li class="L2"><code class="lang-php"><span class="pln">    toArray</span><span class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">将当前激活的工作表，解析全部放入数组中</span></code></li></ol></pre>